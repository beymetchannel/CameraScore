<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CameraScore</title>
<style>
@font-face {
  font-family: 'CyberFont';
  src: url('CyberFont.ttf') format('truetype');
}

@font-face {
  font-family: 'DS-DIGIB';
  src: url('DS-DIGIB.ttf') format('truetype');
}
/* フォント定義は環境によるので任意で差し替え */
body, html { margin:0; padding:0; height:100%; background:black; font-family: 'CyberFont', sans-serif; }
video#camera { position:absolute; inset:0; width:100%; height:100%; object-fit:cover; z-index:0; }


.score {
  font-family: 'DS-DIGIB', monospace !important;
}
  
.score-display {
  font-size: 20vh; /* ←ここは20%の指定だったはず。必要に応じて修正 */
  color: #fff; 
  text-shadow: 0 0 10px orange, 0 0 20px orange, 0 0 40px orange;
}
  
.ui-layer { position:absolute; inset:0; pointer-events:none; z-index:1; }

.bi-border {
  position:absolute; inset:0; pointer-events:none; z-index:0;
  background-image: url('bi.png'); background-size:contain; background-position:center; background-repeat:no-repeat;
  opacity:.6; filter: drop-shadow(0 0 20px #0ff);
  animation: glow 2s infinite alternate;
}
@keyframes glow { 0%{filter:drop-shadow(0 0 10px #0ff)} 50%{filter:drop-shadow(0 0 25px #0ff)} 100%{filter:drop-shadow(0 0 10px #0ff)} }

/* 左右ブロック */
.left-block, .right-block {
  position:absolute; top:20px; display:flex; flex-direction:column; pointer-events:auto;
}
.left-block { left:20px; }
.right-block { right:20px; align-items:flex-end; }

/* 選択ボックスもCyberFontに */
select, select option {
  font-family: 'CyberFont', sans-serif !important;
  letter-spacing: 1px;
}

  /* カード上のブレーダー選択box */
.blader-select {
    font-size: 1.3rem; /* 元より少し大きめ */
}

/* 4点取得時の表示背景 */
.win-overlay {
  position: fixed;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: rgba(255, 255, 255, 0.2);
  color: #ffea50;
  font-family: 'CyberFont', sans-serif;
  font-size: 8vw;         /* 画面幅に応じて可変 */
  text-align: center;
  white-space: pre-line;   /* 改行を反映 */
  text-shadow: 
     0 0 10px #fff59e,
     0 0 20px #ffea50,
     0 0 40px #ffdd33,
     0 0 60px #ffdd33;
  z-index: 1000;
  animation: winFlash 4s ease-out forwards;
}

@keyframes winFlash {
  0% {
    transform: scale(0.5);
    opacity: 0;
  }
  20% {
    transform: scale(1.5);
    opacity: 1;
  }
  50% {
    transform: scale(1.2);
    opacity: 1;
  }
  80% {
    transform: scale(1);
    opacity: 0.8;
  }
  100% {
    transform: scale(1);
    opacity: 0;
  }
}

/* 選択ボックス */
/* 左右ブロックの選択ボックス */
.left-block select,
.right-block select {
  font-size: 1.3rem;   /* 元の 1.5rem から少し大きく */
  font-family: 'CyberFont', sans-serif !important;
  letter-spacing: 1px;
  width: 40vw;
  max-width: 400px;
  min-width: 120px;
  padding: 10px 12px;
  margin-bottom: 10px;
  background: rgba(0,0,0,0.7);
  color: #fff;
  border-radius: 8px;
  border: 2px solid;
  appearance: none;
  cursor: pointer;
  box-sizing: border-box;
}

.left-block select { border-color: #aaffff; }
.right-block select { border-color: #ffaaaa; text-align-last: right; }

/* optionも文字サイズを大きく */
.left-block select option,
.right-block select option {
  font-size: 1.3rem;  /* selectと同じサイズに合わせる */
}
/* フレーム群 */
.frame-container { display:flex; flex-direction:column; gap:0; }
.frame {
  width:60px; height:10vh; border:2px solid; position:relative; overflow:hidden;
  background: rgba(0,0,0,.7); backdrop-filter: blur(4px);
  box-shadow: 0 0 15px, inset 0 0 30px; transition:transform .3s, box-shadow .3s;
}
.frame + .frame { border-top-left-radius:0; border-top-right-radius:0; }

/* 色 */
.frame.blue { border-color:#aaffff; box-shadow:0 0 15px #aaffff, inset 0 0 30px #aaffff;}
.frame.pink { border-color:#ffaaaa; box-shadow:0 0 15px #ffaaaa, inset 0 0 30px #ffaaaa; }

/* HUD 画像（中央に収める） */
.hud-ring {
  position:absolute;
  top:50; left:50;
  width:80; height:80;
  transform:translate(-50%,-50%);
  object-fit:contain;
  pointer-events:none;
  animation: hudSpin 3s linear infinite;
}
@keyframes hudSpin { from{transform:translate(-50%,-50%) rotate(0deg)} to{transform:translate(-50%,-50%) rotate(360deg)} }

/* 以前の円（cyber-circle）を残したい場合はそのまま */
.cyber-circle {
  position:absolute; width:55%; height:55%; border-radius:50%;
  top:50%; left:50%; transform:translate(-50%,-50%); pointer-events:none;
  animation: noiseSlow 4s infinite steps(5);
}
@keyframes noiseSlow { 0%{opacity:.15;filter:blur(1px)} 25%{opacity:.95;filter:blur(0)} 100%{opacity:.6;filter:blur(.3px)} }

/* スコア表示 */
.score { font-family: monospace; font-size:25vh; color:#ffdd99; margin-top:5px; text-align:center;
  text-shadow: 0 0 10px #ffaa33,0 0 20px #ffaa33,0 0 40px #ff4400;
  pointer-events:auto;
}
.score.flash { animation: scoreFlash .25s ease-out; }
@keyframes scoreFlash { 0%{transform:scale(1)}50%{transform:scale(1.25)}100%{transform:scale(1)} }

/* finish */
.finish-flash {
  position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:99;
  background: rgba(255,255,255,.95); backdrop-filter: blur(3px);
  color:#ffea50; font-family:inherit; font-size:8vw; text-shadow:0 0 25px #fff59e;
  pointer-events:none;
  animation: finishBlink 4s ease-out forwards;
}
@keyframes finishBlink {
  0% { opacity:0 }
  5% { opacity:1 }     /* 瞬間フェードイン */
  100% { opacity:0 }   /* ゆっくりフェードアウト */
}

/* スコアコンテナとブレーダー名 */
/* スコアコンテナとブレーダー名 */
.score-container { display:flex; align-items:center; gap:.8vw; pointer-events:auto; }

/* 左ブレーダー名 */
.left-score-container .blader-name {
    padding: 8px 12px;
    background: rgba(0,0,0,.7);
    color: #fff;
    border: 2px solid #aaffff; /* 左選択ボックスの色に合わせる */
    border-radius: 8px;
    cursor: text;
    white-space: nowrap;
    font-size: 1.6rem; /* フォントサイズを大きく */
}

/* 右ブレーダー名 */
.right-score-container .blader-name {
    padding: 8px 12px;
    background: rgba(0,0,0,.7);
    color: #fff;
    border: 2px solid #ffaaaa; /* 右選択ボックスの色に合わせる */
    border-radius: 8px;
    cursor: text;
    white-space: nowrap;
    font-size: 1.6rem; /* フォントサイズを大きく */
}
.blader-name { padding:5px 10px; background:rgba(0,0,0,.7); color:#fff; border:2px solid #ffdd99; border-radius:8px; cursor:text; white-space:nowrap; }


/* スコア加点時の光と拡大エフェクト */
.score-bonus {
  animation: scoreBonus 0.5s ease-out forwards;
}

@keyframes scoreBonus {
  0%   { transform: scale(1); text-shadow: 0 0 10px #ffaa33, 0 0 20px #ffaa33; color:#ffdd99; }
  30%  { transform: scale(1.5); text-shadow: 0 0 20px #fff, 0 0 40px #ffea50; color:#fff59e; }
  60%  { transform: scale(1.3); text-shadow: 0 0 15px #ffdd33, 0 0 30px #ffaa33; color:#ffdd33; }
  100% { transform: scale(1); text-shadow: 0 0 10px #ffaa33, 0 0 20px #ffaa33; color:#ffdd99; }
}

.center-block {
  position: absolute;
  top: 20px;             /* 選択ボックスに合わせる */
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  pointer-events: none;
  z-index: 2;
}

.center-battle {
  font-family: 'CyberFont', sans-serif;
  font-size: 1rem;       /* 小さく */
  color: #ffdd33;
  text-shadow: 0 0 5px #fff, 0 0 10px #ffea50;
}

.center-score {
  font-family: 'DS-DIGIB', monospace;
  font-size: 2.5rem;     /* 大きく */
  color: #ffdd33;
  text-shadow: 0 0 10px #ffaa33, 0 0 20px #ffaa33, 0 0 40px #ff4400;
}
  
  
</style>
</head>
<body>

<video id="camera" autoplay playsinline></video>
<div class="bi-border"></div>

<div class="ui-layer">
  <!-- 左 -->
  <div class="left-block">
    <select class="left-select">
      <option>ウィザードロッド3-60B</option>
      <option>ブラストW9-60LR</option>
      <option>シャークスケイル1-60FB</option>
    </select>
    <div class="frame-container left-frames">
      <div class="frame blue"></div>
      <div class="frame blue"></div>
      <div class="frame blue"></div>
      <div class="frame blue"></div>
    </div>
    <div class="score-container left-score-container">
      <div class="score" id="score-left">0</div>
      <div class="blader-name" contenteditable="true" id="left-blader">BLADER A</div>
    </div>
  </div>
  <!-- バトルカウント -->
  <div class="center-block">
    <div class="center-battle">Battle</div>
    <div class="center-score">01</div>
  </div>
  <!-- 右 -->
  <div class="right-block">
    <select class="right-select">
      <option>ウィザードロッド3-60B</option>
      <option>ブラストW9-60LR</option>
      <option>シャークスケイル1-60FB</option>
    </select>
    <div class="frame-container right-frames">
      <div class="frame pink"></div>
      <div class="frame pink"></div>
      <div class="frame pink"></div>
      <div class="frame pink"></div>
    </div>
    <div class="score-container right-score-container">
      <div class="blader-name" contenteditable="true" id="right-blader">BLADER B</div>
      <div class="score" id="score-right">0</div>
    </div>
  </div>
</div>

<script>
// カメラ取得（任意）
navigator.mediaDevices?.getUserMedia?.({ video:{ facingMode:'environment' }, audio:false })
  .then(s => document.getElementById('camera').srcObject = s)
  .catch(e => console.warn('カメラ取得失敗:', e));

// updateScore: コンテナ（.left-block か .right-block）を渡す
function updateScore(container) {
  if (!container) return;

  const count = container.querySelectorAll('.hud-ring').length; // cyber-circle は未使用
  const scoreEl = container.querySelector('.score');

  if (scoreEl) {
    // スコアが増えたときだけエフェクト
    const prevScore = parseInt(scoreEl.textContent || '0');
    scoreEl.textContent = count;
    if (count > prevScore) {
      scoreEl.classList.remove('score-bonus');
      void scoreEl.offsetWidth; // 再トリガー
      scoreEl.classList.add('score-bonus');
    }
  }

  if (count === 4) {
    const bladerNameEl = container.querySelector('.blader-name');
    const bladerName = bladerNameEl ? bladerNameEl.textContent : 'BLADER';
    showFinishEffect(bladerName);
  }
}

function showFinishEffect(bladerName){
  const div = document.createElement('div');
  div.className = 'win-overlay';
  div.textContent = `${bladerName}\nWIN‼︎`;  // 改行 & 「‼︎」
  document.body.appendChild(div);

  // 2秒後に削除
  setTimeout(()=>div.remove(), 2000);
}

// フレームクリックで HUD を toggle（画像を追加/削除）
function toggleHud(frame) {
  const existing = frame.querySelector('.hud-ring');
  if (existing) {
    existing.remove();
  } else {
    const img = document.createElement('img');

    // 右ブロックか左ブロックかで画像を変える
    const container = frame.closest('.left-block, .right-block');
    if (container.classList.contains('right-block')) {
      img.src = 'HudLing-pink.png';
    } else {
      img.src = 'HudLing.png';
    }

    img.className = 'hud-ring';
    img.style.position = 'absolute';
    img.style.top = '50%';
    img.style.left = '50%';
    img.style.width = '80px';
    img.style.height = '80px';
    img.style.transform = 'translate(-50%, -50%)';
    img.style.pointerEvents = 'none';
    frame.appendChild(img);
  }

  // 親ブロックを再計算してスコア更新
  const container = frame.closest('.left-block, .right-block');
  updateScore(container);
}

function updateScore(container) {
  if (!container) return;
  
  const count = container.querySelectorAll('.hud-ring').length; // cyber-circle は未使用
  const scoreEl = container.querySelector('.score');
  if (scoreEl) scoreEl.textContent = count;

  if (count === 4) {
    const bladerNameEl = container.querySelector('.blader-name');
    const bladerName = bladerNameEl ? bladerNameEl.textContent : 'BLADER';
    console.log('WIN!!', bladerName);
    showFinishEffect(bladerName);
  }
}

// クリックでHUD切替
document.querySelectorAll('.frame').forEach(frame=>{
  frame.addEventListener('click', (e)=>{
    // フレーム上のクリックは HUD toggle のみ
    // （frame 内へ要素を追加しているので pointer-events:none なら重ならない）
    toggleHud(frame);
  });
});

// 選択ボックスが変わったら両ブロックをクリア
document.querySelectorAll('.left-select, .right-select').forEach(sel => {
  sel.addEventListener('change', (e) => {

    // 左右両方のブロックを取得
    const allBlocks = document.querySelectorAll('.left-block, .right-block');
    allBlocks.forEach(block => {
      // フレーム内の HUD と cyber-circle を全て削除
      block.querySelectorAll('.hud-ring, .cyber-circle').forEach(n => n.remove());
      // リセットスコア
      const scoreEl = block.querySelector('.score');
      if (scoreEl) scoreEl.textContent = '0';
    });
  });
});

// 初期スコア更新
document.querySelectorAll('.left-block, .right-block').forEach(block=>updateScore(block));

</script>
</body>
</html>
