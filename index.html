<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="apple-touch-icon" sizes="180x180" href="https://i.imgur.com/gljnX0R.png"><!-- iOSホーム画面用アイコン -->
<title>CameraScore</title>
<style>
@font-face {
    font-family: 'CyberFont';
    src: url('CyberFont.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
}

@font-face {
    font-family: 'DS-DIGIB';
    src: url('DS-DIGIB.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
}


body, html {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    background: black;
    font-family: 'CyberFont', sans-serif;
}

video#camera {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 0;
}

.ui-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
}

.cyber-border {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 2;

    /* 画像を縁取りとして表示 */
    background-image: url('bi.png');
    background-size: cover;      /* 画面全体にフィット */
    background-position: center; 
    background-repeat: no-repeat;

    border: none;                /* 元の枠線は不要 */
    
    /* 薄く光らせる場合 */
    filter: drop-shadow(0 0 10px #0ff);
    animation: glow 2s infinite alternate;
}

@keyframes glow {
    0% { filter: drop-shadow(0 0 5px #0ff); }
    50% { filter: drop-shadow(0 0 15px #0ff); }
    100% { filter: drop-shadow(0 0 5px #0ff); }
}




    
/* 左右ブロック */
.left-block {
    position: absolute;
    top: 20px;
    left: 20px;  
    display: flex;
    flex-direction: column;
    pointer-events: auto;
}

.right-block {
    position: absolute;
    top: 20px;
    right: 20px; /* 右端から */
    display: flex;
    flex-direction: column;
    pointer-events: auto;
    align-items: flex-end; /* 子要素を右寄せ */
}

/* 選択ボックス */
.left-block select,
.right-block select {
    width: 40vw;      /* 画面幅の40% */
    max-width: 400px; 
    min-width: 120px; /* 狭い画面時の最小幅 */
    font-family: 'CyberFont';
    font-size: clamp(12px, 2vw, 22px);
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
    box-sizing: border-box;
    background: rgba(0,0,0,0.7);
    color: #fff;
    border: 2px solid;
    border-radius: 8px;
    padding: 10px 12px;
    appearance: none;
    cursor: pointer;
    margin-bottom: 10px;
}

/* フレームコンテナも右ブロックは右寄せ */
.left-block .frame-container {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.right-block .frame-container {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
}
    
/* 左右で選択ボックスの縁色を変更 */
.left-block select { border-color: #aaffff; } /* 白っぽい青 */
.right-block select {
    padding: 10px 12px;
    border: 2px solid #ffaaaa; /* これで枠線ピンク */
    display: block;
    margin-left: auto; /* 右寄せ */
    text-align: right; /* テキストも右寄せ */
}

.right-block .frame-container {
    flex-direction: column; 
    align-items: center;
}

/* 四角のサイズは画面の50%÷4 */
.frame {
    width: 60px;
    height: 10vh; /* 4つで40% */
    border: 3px solid;
    position: relative;
    box-shadow: 0 0 15px, 0 0 30px inset; 
    transition: transform 0.3s, box-shadow 0.3s;
} 

/* 隣接四角の上角丸無効 */
.frame + .frame {
    border-top-left-radius: 0;
    border-top-right-radius: 0;
}

/* 左右の色・光 */
.blue { 
    border-color: #aaffff; 
    box-shadow: 0 0 15px #aaffff, 0 0 30px #aaffff inset; 
}

.pink { 
    border-color: #ffaaaa; 
    box-shadow: 0 0 15px #ffaaaa, 0 0 30px #ffaaaa inset; 
}

/* スコア */
.score {
    font-family: 'DS-DIGIB', sans-serif;
    font-size: 25vh;
    color: #ffdd99; /* 白っぽい文字色 */
    text-align: center;
    margin-top: 5px;
    text-shadow:
        0 0 10px #ffaa33,
        0 0 20px #ffaa33,
        0 0 40px #ff4400,
        0 0 60px #ff3300;
    animation: neonPulse 1.5s infinite alternate;
}

@keyframes neonPulse {
    0% {
        text-shadow:
            0 0 5px #ffaa33,
            0 0 10px #ffaa33,
            0 0 20px #ff4400,
            0 0 30px #ff3300;
    }
    50% {
        text-shadow:
            0 0 15px #ffaa33,
            0 0 30px #ffaa33,
            0 0 60px #ff4400,
            0 0 90px #ff3300;
    }
    100% {
        text-shadow:
            0 0 10px #ffaa33,
            0 0 20px #ffaa33,
            0 0 40px #ff4400,
            0 0 60px #ff3300;
    }
}
</style>
</head>
<body>

<video id="camera" autoplay playsinline></video>

<div class="cyber-border"></div>

<div class="ui-layer">
    <!-- 左側 -->
    <div class="left-block">
        <select>
            <option>ウィザードロッド3-60B</option>
            <option>ブラストW9-60LR</option>
            <option>シャークスケイル1-60FB</option>
        </select>
        <div class="frame-container">
            <div class="frame blue"></div>
            <div class="frame blue"></div>
            <div class="frame blue"></div>
            <div class="frame blue"></div>
            <div class="score" id="score-left">0</div>
        </div>
    </div>

    <!-- 右側 -->
    <div class="right-block">
        <select>
            <option>ウィザードロッド3-60B</option>
            <option>ブラストW9-60LR</option>
            <option>シャークスケイル1-60FB</option>
        </select>
        <div class="frame-container">
            <div class="frame pink"></div>
            <div class="frame pink"></div>
            <div class="frame pink"></div>
            <div class="frame pink"></div>
            <div class="score" id="score-right">0</div>
        </div>
    </div>
</div>

<script>
// アウトカメラ
navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' }, audio: false })
    .then(stream => { document.getElementById('camera').srcObject = stream; })
    .catch(err => { console.error('カメラ取得エラー:', err); });

// 四角のフレームごとにクリックイベント
function updateScore(container) {
    const scoreEl = container.querySelector('.score');
    const circles = container.querySelectorAll('.cyber-circle').length;
    scoreEl.textContent = circles;

    // score flash
    scoreEl.classList.remove("flash");
    void scoreEl.offsetWidth;
    scoreEl.classList.add("flash");

}

function showFinishEffect(text) {
    const flash = document.createElement("div");
    flash.className = "finish-flash";
    flash.textContent = text;
    document.body.appendChild(flash);
    
    setTimeout(() => flash.remove(), 450);
}

document.querySelectorAll('.frame-container').forEach(container => {
    const frames = container.querySelectorAll('.frame');

    frames.forEach(frame => {
        frame.addEventListener('click', () => {
            let circle = frame.querySelector('.cyber-circle');

            if (circle) {
                circle.remove();
                updateScore(container);
                return;
            }

            let target = [...frames].find(f => !f.querySelector('.cyber-circle'));
            if (!target) return;

            circle = document.createElement('div');
            circle.className = 'cyber-circle';

            if(target.classList.contains('blue')){
                circle.style.border = '3px solid #aaffff';
                circle.style.boxShadow = '0 0 20px #aaffff, 0 0 35px #aaffff inset';
            } else {
                circle.style.border = '3px solid #ffaaaa';
                circle.style.boxShadow = '0 0 20px #ffaaaa, 0 0 35px #ffaaaa inset';
            }

            target.appendChild(circle);
            updateScore(container);
        });
    });
});

document.querySelectorAll('.left-block select, .right-block select').forEach(select => {
    select.addEventListener('change', () => {
        // 左右両方のブロックを取得
        document.querySelectorAll('.left-block, .right-block').forEach(block => {
            const container = block.querySelector('.frame-container');
            const frames = container.querySelectorAll('.frame');
            const scoreEl = container.querySelector('.score');

            // 円をすべて削除
            frames.forEach(frame => {
                frame.querySelectorAll('.cyber-circle').forEach(c => c.remove());
            });

            // スコアを0にリセット
            scoreEl.textContent = '0';
        });
    });
});

    
</script>

<style>
/* 脈打つ円のアニメーション */
@keyframes pulse {
    0% { transform: scale(1); opacity: 0.7; }
    50% { transform: scale(1.3); opacity: 1; }
    100% { transform: scale(1); opacity: 0.7; }
}

/* 円：ゆっくりノイズ明滅（拡大無し） */
.cyber-circle {
    position: absolute;
    width: 55%;
    height: 55%;
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    animation: noiseSlow 4s infinite steps(5);
}

@keyframes noiseSlow {
    0% { opacity: 0.15; filter: blur(1px); }
    10% { opacity: 0.45; filter: blur(0.5px); }
    25% { opacity: 0.95; filter: blur(0px); }
    40% { opacity: 0.35; filter: blur(1px); }
    60% { opacity: 0.8; filter: blur(0.5px); }
    80% { opacity: 0.25; filter: blur(1.2px); }
    100% { opacity: 0.6; filter: blur(0.3px); }
}



/* スコア光る */
.score.flash {
    animation: scoreFlash 0.25s ease-out;
}

@keyframes scoreFlash {
    0% { transform: scale(1); text-shadow: 0 0 30px #fff, 0 0 60px #ff0; }
    50% { transform: scale(1.25); text-shadow: 0 0 60px #fff, 0 0 100px #ff0; }
    100% { transform: scale(1); text-shadow: 0 0 30px #ffaa33, 0 0 60px #ff3300; }
}

/* フィニッシュ演出 */
.finish-flash {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(3px);
    animation: finishBlink 2s ease-out forwards;
    z-index: 99;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: 'CyberFont';
    color: #0ff;
    text-shadow: 0 0 20px #0ff, 0 0 40px #fff;
    font-size: 8vw;
}

@keyframes finishBlink {
    0% { opacity: 0; }
    10% { opacity: 1; }
    85% { opacity: 1; }
    100% { opacity: 0; }
}
</style>



</body>
</html>
