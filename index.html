<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="apple-touch-icon" sizes="180x180" href="https://i.imgur.com/gljnX0R.png"><!-- iOSホーム画面用アイコン -->
<title>CameraScore</title>
<style>
@font-face {
    font-family: 'CyberFont';
    src: url('CyberFont.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
}

@font-face {
    font-family: 'DS-DIGIB';
    src: url('DS-DIGIB.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
}


body, html {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    background: black;
    font-family: 'CyberFont', sans-serif;
}

video#camera {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 0;
}

.ui-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
}

.bi-border {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0; /* 最背面 */

    background-image: url('bi.png');
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;

    opacity: 0.6; /* 半透明 */
    filter: drop-shadow(0 0 20px #0ff); /* グロウ効果 */
    animation: glow 2s infinite alternate;
}

@keyframes glow {
    0%   { filter: drop-shadow(0 0 10px #0ff); }
    50%  { filter: drop-shadow(0 0 25px #0ff); }
    100% { filter: drop-shadow(0 0 10px #0ff); }
}




    
/* 左右ブロック */
.left-block {
    position: absolute;
    top: 20px;
    left: 20px;  
    display: flex;
    flex-direction: column;
    pointer-events: auto;
}

.right-block {
    position: absolute;
    top: 20px;
    right: 20px; /* 右端から */
    display: flex;
    flex-direction: column;
    pointer-events: auto;
    align-items: flex-end; /* 子要素を右寄せ */
}

/* 選択ボックス */
.left-block select,
.right-block select {
    width: 40vw;      /* 画面幅の40% */
    max-width: 400px; 
    min-width: 120px; /* 狭い画面時の最小幅 */
    font-family: 'CyberFont';
    font-size: clamp(12px, 2vw, 22px);
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
    box-sizing: border-box;
    background: rgba(0,0,0,0.7);
    color: #fff;
    border: 2px solid;
    border-radius: 8px;
    padding: 10px 12px;
    appearance: none;
    cursor: pointer;
    margin-bottom: 10px;
}

/* フレームコンテナも右ブロックは右寄せ */
.left-block .frame-container {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.right-block .frame-container {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
}
    
/* 左右で選択ボックスの縁色を変更 */
.left-block select { border-color: #aaffff; } /* 白っぽい青 */
.right-block select {
    padding: 10px 12px;
    border: 2px solid #ffaaaa; /* これで枠線ピンク */
    display: flex;
    justify-content: flex-end;
    margin-left: auto; /* 右寄せ */
    text-align-last: right;
}

.right-block .frame-container {
    flex-direction: column; 
    align-items: center;
}

/* 四角のサイズは画面の50%÷4 */
.frame {
    width: 60px;
    height: 10vh;
    border: 3px solid;
    position: relative;
    box-shadow: 0 0 15px, 0 0 30px inset;
    transition: transform 0.3s, box-shadow 0.3s;

    /* ★追加：黒透明＋HUDぽくぼかし */
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(4px);
}

/* 隣接四角の上角丸無効 */
.frame + .frame {
    border-top-left-radius: 0;
    border-top-right-radius: 0;
}

/* 左右の色・光 */
.blue { 
    border-color: #aaffff; 
    box-shadow: 0 0 15px #aaffff, 0 0 30px #aaffff inset; 
}

.pink { 
    border-color: #ffaaaa; 
    box-shadow: 0 0 15px #ffaaaa, 0 0 30px #ffaaaa inset; 
}

/* スコア */
.score {
    font-family: 'DS-DIGIB', sans-serif;
    font-size: 25vh;
    color: #ffdd99; /* 白っぽい文字色 */
    text-align: center;
    margin-top: 5px;
    text-shadow:
        0 0 10px #ffaa33,
        0 0 20px #ffaa33,
        0 0 40px #ff4400,
        0 0 60px #ff3300;
    animation: neonPulse 1.5s infinite alternate;
}

@keyframes neonPulse {
    0% {
        text-shadow:
            0 0 5px #ffaa33,
            0 0 10px #ffaa33,
            0 0 20px #ff4400,
            0 0 30px #ff3300;
    }
    50% {
        text-shadow:
            0 0 15px #ffaa33,
            0 0 30px #ffaa33,
            0 0 60px #ff4400,
            0 0 90px #ff3300;
    }
    100% {
        text-shadow:
            0 0 10px #ffaa33,
            0 0 20px #ffaa33,
            0 0 40px #ff4400,
            0 0 60px #ff3300;
    }
}

.slot img.hud-ring {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 80%;
  height: auto;
  transform: translate(-50%, -50%);
  pointer-events: none;
  animation: hudRotate 5s linear infinite;
  opacity: 1;
}

@keyframes hudRotate {
  from { transform: translate(-50%, -50%) rotate(0deg); }
  to { transform: translate(-50%, -50%) rotate(360deg); }
}


    
</style>
</head>
<body>

<video id="camera" autoplay playsinline></video>

<div class="bi-border"></div>

<div class="ui-layer">
    <!-- 左側 -->
    <div class="left-block">
        <select>
            <option>ウィザードロッド3-60B</option>
            <option>ブラストW9-60LR</option>
            <option>シャークスケイル1-60FB</option>
        </select>
        <div class="frame-container">
            <div class="frame blue"></div>
            <div class="frame blue"></div>
            <div class="frame blue"></div>
            <div class="frame blue"></div>
        </div>
        <div class="score-container left-score-container">
            <div class="score" id="score-left">0</div>
            <div class="blader-name" id="left-blader" contenteditable="true">BLADER A</div>
        </div>
    </div>

    <!-- 右側 -->
    <div class="right-block">
        <select>
            <option>ウィザードロッド3-60B</option>
            <option>ブラストW9-60LR</option>
            <option>シャークスケイル1-60FB</option>
        </select>
        <div class="frame-container">
            <div class="frame pink"></div>
            <div class="frame pink"></div>
            <div class="frame pink"></div>
            <div class="frame pink"></div>
        </div>
        <div class="score-container right-score-container">
            <div class="blader-name" id="right-blader" contenteditable="true">BLADER B</div>
            <div class="score" id="score-right">0</div>
        </div>
    </div>
</div>

<script>
// アウトカメラ
navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' }, audio: false })
    .then(stream => { document.getElementById('camera').srcObject = stream; })
    .catch(err => { console.error('カメラ取得エラー:', err); });

// 四角のフレームごとにクリックイベント
function updateScore(container) {

    // 先に丸を整理する
    normalizeCircles(container);

    const scoreEl = container.querySelector('.score');
    const circles = container.querySelectorAll('.cyber-circle').length;
    scoreEl.textContent = circles;

    // スコア光アニメ
    scoreEl.classList.remove("flash");
    void scoreEl.offsetWidth;
    scoreEl.classList.add("flash");

    // ★4点時演出
    if (circles === 4) {
        showFinishEffect("FINISH!");
    }
}

function showFinishEffect(text) {
    const flash = document.createElement("div");
    flash.className = "finish-flash";
    flash.textContent = text;
    document.body.appendChild(flash);
    
    setTimeout(() => flash.remove(), 450);
}

document.querySelectorAll('.left-block, .right-block').forEach(block => {
    const frames = block.querySelectorAll('.frame');

    frames.forEach(frame => {
        frame.addEventListener('click', () => {
            let circle = frame.querySelector('.cyber-circle');
        
            if (circle) {
                circle.remove();
                updateScore(block);
                return;
            }
        
            let target = [...frames].find(f => !f.querySelector('.cyber-circle'));
            if (!target) return;
        
            circle = document.createElement('div');
            circle.className = 'cyber-circle';
        
            if(target.classList.contains('blue')){
                circle.style.border = '3px solid #aaffff';
                circle.style.boxShadow = '0 0 20px #aaffff, 0 0 35px #aaffff inset';
            } else {
                circle.style.border = '3px solid #ffaaaa';
                circle.style.boxShadow = '0 0 20px #ffaaaa, 0 0 35px #ffaaaa inset';
            }
        
            target.appendChild(circle);
            updateScore(block);
        });
    });
});

// 左右両方のブロックを取得
document.querySelectorAll('.left-block select, .right-block select').forEach(select => {
    select.addEventListener('change', () => {
        // 自分のブロックだけクリアする（両方消すならループでもOK）
        const block = select.closest('.left-block, .right-block');
        const frames = block.querySelectorAll('.frame');
        const scoreEl = block.querySelector('.score');
    
        // 円を全て消す
        frames.forEach(frame => {
            frame.querySelectorAll('.cyber-circle').forEach(c => c.remove());
        });
    
        // スコアをリセット
        scoreEl.textContent = '0';
    });
});

function normalizeCircles(container) {
    const frames = [...container.querySelectorAll('.frame')];
    let circles = container.querySelectorAll('.cyber-circle').length;

    // 全ての丸を消す
    frames.forEach(f => f.querySelectorAll('.cyber-circle').forEach(c => c.remove()));

    // 上から circles 個 付け直す
    for (let i = 0; i < circles; i++) {
        const target = frames[i];
        const circle = document.createElement('div');
        circle.className = 'cyber-circle';

        if(target.classList.contains('blue')){
            circle.style.border = '3px solid #aaffff';
            circle.style.boxShadow = '0 0 20px #aaffff, 0 0 35px #aaffff inset';
        } else {
            circle.style.border = '3px solid #ffaaaa';
            circle.style.boxShadow = '0 0 20px #ffaaaa, 0 0 35px #ffaaaa inset';
        }

        target.appendChild(circle);
    }
}    

function toggleHud(slot) {
  const img = slot.querySelector(".hud-ring");

  if (img) {
    // すでにHUDがある → 削除
    img.remove();
  } else {
    // HUDがない → 追加
    const newImg = document.createElement("img");
    newImg.src = "HudLing.png"; // 同じディレクトリから読み込み
    newImg.className = "hud-ring";
    slot.appendChild(newImg);
  }

  updateScore(slot.parentElement); // スコア反映
}

function toggleHud(frame) {
  const img = frame.querySelector(".hud-ring");

  if (img) {
    img.remove();
  } else {
    const newImg = document.createElement("img");
    newImg.src = "HudLing.png"; // ファイル名そのまま
    newImg.className = "hud-ring";
    frame.appendChild(newImg);
  }

  // スコア反映（左右のブロックを再計算）
  const container = frame.closest('.left-block, .right-block');
  updateScore(container);
}
    
document.querySelectorAll(".frame").forEach(frame => {
  frame.addEventListener("click", () => {
    toggleHud(frame);
  });
});

</script>

<style>
/* 脈打つ円のアニメーション */
@keyframes pulse {
    0% { transform: scale(1); opacity: 0.7; }
    50% { transform: scale(1.3); opacity: 1; }
    100% { transform: scale(1); opacity: 0.7; }
}

/* 円：ゆっくりノイズ明滅（拡大無し） */
.cyber-circle {
    position: absolute;
    width: 55%;
    height: 55%;
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    animation: noiseSlow 4s infinite steps(5);
}

@keyframes noiseSlow {
    0% { opacity: 0.15; filter: blur(1px); }
    10% { opacity: 0.45; filter: blur(0.5px); }
    25% { opacity: 0.95; filter: blur(0px); }
    40% { opacity: 0.35; filter: blur(1px); }
    60% { opacity: 0.8; filter: blur(0.5px); }
    80% { opacity: 0.25; filter: blur(1.2px); }
    100% { opacity: 0.6; filter: blur(0.3px); }
}



/* スコア光る */
.score.flash {
    animation: scoreFlash 0.25s ease-out;
}

@keyframes scoreFlash {
    0% { transform: scale(1); text-shadow: 0 0 30px #fff, 0 0 60px #ff0; }
    50% { transform: scale(1.25); text-shadow: 0 0 60px #fff, 0 0 100px #ff0; }
    100% { transform: scale(1); text-shadow: 0 0 30px #ffaa33, 0 0 60px #ff3300; }
}

/* フィニッシュ演出 */
.finish-flash {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(3px);
    animation: finishBlink 5s ease-out forwards;
    z-index: 99;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: 'CyberFont';
    color: #ffea50;
    text-shadow: 0 0 25px #fff59e, 0 0 60px #ffdf00;
    font-size: 8vw;
}

@keyframes finishBlink {
  0% {
    opacity: 0;           /* 開始：透明 */
  }
  10% {
    opacity: 1;           /* 一瞬でフェードイン（0% → 10%の間で） */
  }
  100% {
    opacity: 0;           /* ゆっくりフェードアウト（10% → 100%） */
  }
}

    
/* スコア＋名前の横並び */
.score-container {
    display: flex;
    flex-direction: row;
    align-items: center;
    margin-top: 1vh;
    gap: 0.5vw;
}

/* 左側ブレーダー名はスコアの右 */
.left-score-container {
    justify-content: flex-start;
}

.left-score-container .blader-name {
    height: 100%;
    font-size: clamp(18px, 2vw, 28px);
    line-height: 1.2; 
    margin-left: 1vw; 
}

/* 右側ブレーダー名はスコアの左 */
.right-score-container {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: flex-end;
}

.right-score-container .blader-name {
    height: 100%;
    font-size: clamp(18px, 2vw, 28px);
    line-height: 1.2; 
    margin-right: 1vw; 
}

/* ブレーダー名ボックス */
.blader-name {
    font-family: 'CyberFont', sans-serif;
    font-size: clamp(16px, 2.5vh, 24px);
    padding: 5px 10px;
    background: rgba(0,0,0,0.7);
    color: #fff;
    border: 2px solid #ffdd99;
    border-radius: 8px;
    white-space: nowrap;
    cursor: text;
    outline: none; 
    box-sizing: border-box;
}

</style>



</body>
</html>
